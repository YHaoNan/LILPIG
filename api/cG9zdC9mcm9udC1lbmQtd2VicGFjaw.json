{"title":"Webpack入门（一） 基本概念","date":"2019-08-18T06:55:27.000Z","slug":"front-end-webpack","tags":["webpack","前端"],"categories":["Webpack"],"updated":"2019-08-18T07:10:24.322Z","content":"<p>在前端逐渐模块化的今天，不会nodejs和webpack简直就像外星人一样…</p>\n<h2 id=\"webpack项目的创建\">webpack项目的创建<a href=\"post/front-end-webpack#webpack项目的创建\"></a></h2><p>先创建一个文件夹，之后运行：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm init</span><br></pre></td></tr></table></figure></p>\n<p>Webpack4版本中需要安装<code>webpack</code>和<code>webpack-cli</code>两个工具：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i -D webpack webpack-cli</span><br><span class=\"line\">B</span><br></pre></td></tr></table></figure></p>\n<p>这样一来项目的依赖就全都下载好了，我们可以开始创建项目结构了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.</span><br><span class=\"line\">├── dist</span><br><span class=\"line\">│   └── index.html</span><br><span class=\"line\">├── package.json</span><br><span class=\"line\">├── package-lock.json</span><br><span class=\"line\">├── src</span><br><span class=\"line\">│   └── index.js</span><br><span class=\"line\">└── webpack.config.js</span><br></pre></td></tr></table></figure>\n<p>A<br>这是一个webpack项目最基本的目录结构，<code>dist</code>中是生成的目标文件和SPA应用的主html文件，<code>src</code>是我们编写的代码，<code>webpack.config.js</code>是webpack的配置文件。</p>\n<p>我们首先编写<code>src</code>中的<code>index.js</code>：<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createElement</span>(<span class=\"params\">text</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> div = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'div'</span>);</span><br><span class=\"line\">    div.innerText = text;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> div;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">document</span>.body.append(createElement(<span class=\"string\">'Hello,World!'</span>))</span><br></pre></td></tr></table></figure></p>\n<p>代码很简单，就是往body中添加一个div。</p>\n<p>接下来是<code>dist</code>中的<code>index.html</code><br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width, initial-scale=1.0\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"X-UA-Compatible\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"ie=edge\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Document<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"./main.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>这个html中引用一个<code>main.js</code>，可是并没有这个文件，这个就是webpack给我们生成的文件。我们需要在<code>webpack.config.js</code>中编写配置：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    entry: <span class=\"string\">'./src/index.js'</span>,</span><br><span class=\"line\">    mode: <span class=\"string\">'development'</span>,</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">        filename: <span class=\"string\">'main.js'</span>,</span><br><span class=\"line\">        path: path.resolve(__dirname,<span class=\"string\">'dist'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这个配置文件导出了一个对象，这个对象就是webpack项目的配置，<code>entry</code>指定了入口文件，我们的入口文件就是刚刚编写的<code>index.js</code>，mode是模式，我们指定开发模式，output则是输出配置，这里就看到了<code>main.js</code>的身影，我们把他导出到<code>dist/main.js</code>。</p>\n<p>在浏览器中打开这个<code>index.html</code>，我们编写的div显示了出来。</p>\n<h2 id=\"loader\">loader<a href=\"post/front-end-webpack#loader\"></a></h2><p>在webpack中，万物都是模块，甚至图片和字体都是模块。一个web工程肯定会包括很多资源文件，比如CSS、JS、图片、模板、字体等等，webpack本身只能处理js，所以需要各式各样的loader来处理这些文件。</p>\n<p>其实loader的本质就是一个函数，你传入一个东西，它给你返回处理后的东西。比如使用<code>babel-loader</code>将es6的js语法转换为es5，可以理解为其工作原理是这样的：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ES5 = babel-loader(ES6)</span><br></pre></td></tr></table></figure></p>\n<p>loader也可以是链式的，例如我们在使用scss时需要将它编译成css，然后再加载到html的style标签中，就像如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Style Element = style-loader(css-loader(scss-loader(SCSS)))</span><br></pre></td></tr></table></figure></p>\n<p>下面开始在webpack中使用loader工作，我们在src中创建一个css文件，并且引入它：</p>\n<p><code>style.css</code><br><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">body</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#f00</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">1.5em</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><code>index.js</code><br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./style.css'</span></span><br><span class=\"line\"><span class=\"comment\">//...</span></span><br></pre></td></tr></table></figure></p>\n<p>运行示例，发现报错了：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ERROR in ./src/style.css 1:4</span><br><span class=\"line\">Module parse failed: Unexpected token (1:4)</span><br><span class=\"line\">You may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders</span><br><span class=\"line\">&gt; body&#123;</span><br><span class=\"line\">|     color: #f00;</span><br><span class=\"line\">|     font-size: 1.5em;</span><br><span class=\"line\"> @ ./src/index.js 1:0-20</span><br></pre></td></tr></table></figure></p>\n<p>从异常信息看，是因为没有一个loader来处理css类型的文件，所以我们需要安装并配置loader。</p>\n<p>安装<code>css-loader</code>和<code>style-loader</code>，他们分别用来解析css文件和把css插入到html的style标签中。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i -D css-loader style-loader</span><br></pre></td></tr></table></figure>\n<p>安装完后，修改<code>webpack.config.js</code>去针对css文件设置使用这两个loader。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    entry: <span class=\"string\">'./src/index.js'</span>,</span><br><span class=\"line\">    mode: <span class=\"string\">'development'</span>,</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">        filename: <span class=\"string\">'main.js'</span>,</span><br><span class=\"line\">        path: path.resolve(__dirname,<span class=\"string\">'dist'</span>)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">        rules: [&#123;</span><br><span class=\"line\">            test: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">            use: [<span class=\"string\">'style-loader'</span>,<span class=\"string\">'css-loader'</span>]</span><br><span class=\"line\">        &#125;]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在<code>module</code>中设置一个rules，里面是针对引入的资源文件的扩展类型而使用的loader，上面我们指定了一个css类型的文件，并且使用了这两个loader，使用数组方式声明loader会从后向前链式调用。</p>\n<h2 id=\"loader-options\">loader-options<a href=\"post/front-end-webpack#loader-options\"></a></h2><p>有的loader提供了预置项，可以通过<code>options</code>设置：<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [&#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">        use: [<span class=\"string\">'style-loader'</span>,&#123;</span><br><span class=\"line\">            loader:<span class=\"string\">'css-loader'</span>,</span><br><span class=\"line\">            options: &#123;</span><br><span class=\"line\">                <span class=\"comment\">//配置项</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;]</span><br><span class=\"line\">    &#125;]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"更多配置\">更多配置<a href=\"post/front-end-webpack#更多配置\"></a></h2><h3 id=\"exclude和include\">exclude和include<a href=\"post/front-end-webpack#exclude和include\"></a></h3><p>很多时候loader需要排除一些目录或者仅包含一些目录，这时可以用这两个选项。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [&#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">        use: [<span class=\"string\">'style-loader'</span>,&#123;</span><br><span class=\"line\">            loader:<span class=\"string\">'css-loader'</span>,</span><br><span class=\"line\">            options: &#123;</span><br><span class=\"line\">                <span class=\"comment\">//配置项</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;],</span><br><span class=\"line\">        exclude: <span class=\"regexp\">/node_modules/</span></span><br><span class=\"line\">    &#125;]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"enforce\">enforce<a href=\"post/front-end-webpack#enforce\"></a></h3><p>用来指定一个loader的触发时机，<code>pre</code>代表比所有loader先触发，post表示在所有模块之后触发。</p>\n<h2 id=\"参考资料\">参考资料<a href=\"post/front-end-webpack#参考资料\"></a></h2><ul>\n<li>Webpack实战：入门、进阶与调优</li>\n</ul>\n","prev":{"title":"Vue和Webpack","slug":"vue-webpack"},"next":{"title":"Vue组件的render函数","slug":"vue-render"},"link":"http://lilpig.site/post/front-end-webpack/","toc":[{"title":"webpack项目的创建","id":"webpack项目的创建","index":"1"},{"title":"loader","id":"loader","index":"2"},{"title":"loader-options","id":"loader-options","index":"3"},{"title":"更多配置","id":"更多配置","index":"4","children":[{"title":"exclude和include","id":"exclude和include","index":"4.1"},{"title":"enforce","id":"enforce","index":"4.2"}]},{"title":"参考资料","id":"参考资料","index":"5"}],"reward":true,"copyright":{"author":"LIL PIG","link":"<a href=\"http://lilpig.site/post/front-end-webpack/\" title=\"Webpack入门（一） 基本概念\">http://lilpig.site/post/front-end-webpack/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}