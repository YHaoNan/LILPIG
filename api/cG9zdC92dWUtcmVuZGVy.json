{"title":"Vue组件的render函数","date":"2019-08-17T00:27:00.000Z","slug":"vue-render","tags":["js","vue","前端"],"categories":["Vue"],"updated":"2019-08-17T01:04:46.159Z","content":"<p>之前我们都是用<code>template</code>来给组件提供一个模板，但是这并不一定适合所有情况，而且它最后也会被编译为<code>render</code>的形式，效率比直接用<code>render</code>稍低。</p>\n<p><code>render</code>函数提供了一个虚拟dom，也就是上一篇中提到的那个东西，你可以用这个虚拟dom来创建节点，绑定数据…</p>\n<p>直接用<code>render</code>写的代码会比较冗余，因为是用js而不是html，所以说<code>render</code>函数要看情况使用。</p>\n<p>下面的示例就需要用到render，我们需要一个标题组件，这个组件实现的功能是点击标题后自动给url添加锚点，但因为<code>template</code>中无法访问组件的作用域中的变量，所以这个组件无法工作。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"app\"</span> <span class=\"attr\">v-cloak</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">anchor</span> <span class=\"attr\">:level</span>=<span class=\"string\">\"5\"</span> <span class=\"attr\">title</span>=<span class=\"string\">\"特性\"</span>&gt;</span>特性<span class=\"tag\">&lt;/<span class=\"name\">anchor</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">    Vue.component(<span class=\"string\">'anchor'</span>,&#123;</span></span><br><span class=\"line\"><span class=\"xml\">        template:'<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">:href</span>=<span class=\"string\">\"\\'#\\'+title\"</span> @<span class=\"attr\">mouseenter</span>=<span class=\"string\">\"setHover(true)\"</span> @<span class=\"attr\">mouseleave</span>=<span class=\"string\">\"setHover(false)\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">h'+this.level+'</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">slot</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span>' +</span></span><br><span class=\"line\"><span class=\"xml\">            '<span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">v-show</span>=<span class=\"string\">\"isHover\"</span>&gt;</span>#<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span>' +</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"string\">'&lt;/h'</span>+<span class=\"keyword\">this</span>.level+<span class=\"string\">'&gt;&lt;/a&gt;'</span>,</span></span><br><span class=\"line\"><span class=\"undefined\">        props: &#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            level: &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                type: <span class=\"built_in\">Number</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">default</span>: <span class=\"number\">1</span></span></span><br><span class=\"line\"><span class=\"undefined\">            &#125;,</span></span><br><span class=\"line\"><span class=\"undefined\">            title: &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                type: <span class=\"built_in\">String</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">                required: <span class=\"literal\">true</span></span></span><br><span class=\"line\"><span class=\"undefined\">            &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">        data: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                isHover: <span class=\"literal\">false</span>,</span></span><br><span class=\"line\"><span class=\"undefined\">            &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;,</span></span><br><span class=\"line\"><span class=\"undefined\">        methods: &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            setHover: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">bol</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">this</span>.isHover = bol;</span></span><br><span class=\"line\"><span class=\"undefined\">            &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;,</span></span><br><span class=\"line\"><span class=\"undefined\">    &#125;)</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">var</span> vm = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">'#app'</span></span></span><br><span class=\"line\"><span class=\"undefined\">    &#125;);</span></span><br><span class=\"line\"><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>当然也可以使用<code>v-if</code>来判断<code>level</code>，生成不同的标题，但是这样写代码太冗余，所以这时就要用到render函数。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"app\"</span> <span class=\"attr\">v-cloak</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">anchor</span> <span class=\"attr\">:level</span>=<span class=\"string\">\"1\"</span> <span class=\"attr\">title</span>=<span class=\"string\">\"特性1\"</span>&gt;</span>特性<span class=\"tag\">&lt;/<span class=\"name\">anchor</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">anchor</span> <span class=\"attr\">:level</span>=<span class=\"string\">\"1\"</span> <span class=\"attr\">title</span>=<span class=\"string\">\"特性2\"</span>&gt;</span>特性<span class=\"tag\">&lt;/<span class=\"name\">anchor</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">anchor</span> <span class=\"attr\">:level</span>=<span class=\"string\">\"1\"</span> <span class=\"attr\">title</span>=<span class=\"string\">\"特性3\"</span>&gt;</span>特性<span class=\"tag\">&lt;/<span class=\"name\">anchor</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">    Vue.component(<span class=\"string\">'anchor'</span>,&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        render: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">h</span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">var</span> _this = <span class=\"keyword\">this</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">if</span>(<span class=\"keyword\">this</span>.isHover)&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">var</span> span = h(<span class=\"string\">'span'</span>,<span class=\"string\">'#'</span>)</span></span><br><span class=\"line\"><span class=\"undefined\">            &#125;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">return</span> h(<span class=\"string\">'a'</span>,&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">                attrs:&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                    href: <span class=\"string\">'#'</span>+<span class=\"keyword\">this</span>.title</span></span><br><span class=\"line\"><span class=\"undefined\">                &#125;,</span></span><br><span class=\"line\"><span class=\"undefined\">                on:&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                    mouseenter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        _this.isHover = <span class=\"literal\">true</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">                    &#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                    mouseleave: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        _this.isHover = <span class=\"literal\">false</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">                    &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">                &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">            &#125;,[</span></span><br><span class=\"line\"><span class=\"javascript\">                h(<span class=\"string\">'h'</span>+<span class=\"keyword\">this</span>.level,[</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"keyword\">this</span>.title,</span></span><br><span class=\"line\"><span class=\"undefined\">                    span</span></span><br><span class=\"line\"><span class=\"undefined\">                ])</span></span><br><span class=\"line\"><span class=\"undefined\">            ])</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;,</span></span><br><span class=\"line\"><span class=\"undefined\">        props: &#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            level: &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                type: <span class=\"built_in\">Number</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">default</span>: <span class=\"number\">1</span></span></span><br><span class=\"line\"><span class=\"undefined\">            &#125;,</span></span><br><span class=\"line\"><span class=\"undefined\">            title: &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                type: <span class=\"built_in\">String</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">                required: <span class=\"literal\">true</span></span></span><br><span class=\"line\"><span class=\"undefined\">            &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">        data: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                isHover: <span class=\"literal\">false</span>,</span></span><br><span class=\"line\"><span class=\"undefined\">            &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;,</span></span><br><span class=\"line\"><span class=\"undefined\">    &#125;)</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">var</span> vm = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">'#app'</span></span></span><br><span class=\"line\"><span class=\"undefined\">    &#125;);</span></span><br><span class=\"line\"><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>除了把<code>template</code>替换成<code>render</code>，其他代码没啥变化，<code>render</code>函数传入一个参数，这个参数是用于创建虚拟节点的方法，我们调用它就可以创建虚拟节点。这个方法可以有三个参数，第一个是必选参数是，是html标签名，第二个是可选参数，是该节点的数据对象，用于绑定一些数据和监听器的东西，第三个也是可选参数，是子节点列表。</p>\n<p>我们上面的render代码创建了一个a标签，并且绑定了href为<code>&#39;#&#39;+this.title</code>，用于点击后自动修改url，并且监听他的鼠标事件，去修改<code>isHover</code>，用于显示锚点图标，很多博客站的标题锚点功能都是这样的，包括本博客，就是鼠标进入标题时显示一个图标（本实例中是#号）。然后创建标题节点，作为a的子节点，这里可以访问到组件的作用域，所以<code>&#39;h&#39;+this.level</code>是可以的，然后给它两个子节点，一个是<code>this.title</code>，就是传入的标题，一个是<code>span</code>，这个<code>span</code>是在<code>render</code>函数最开始判断<code>isHover</code>动态创建的，因为<code>render</code>函数中不能用<code>v-if</code>这种命令，所以只能用js提供的结构体来满足功能。</p>\n","prev":{"title":"Webpack入门（一） 基本概念","slug":"front-end-webpack"},"next":{"title":"Vue组件实例","slug":"vue-component-exm"},"link":"http://lilpig.site/post/vue-render/","reward":true,"copyright":{"author":"LIL PIG","link":"<a href=\"http://lilpig.site/post/vue-render/\" title=\"Vue组件的render函数\">http://lilpig.site/post/vue-render/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}